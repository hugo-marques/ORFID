---
title: "Introduction to ORFID"
author: "Hugo Marques and Annika Putt"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to ORFID}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


## Overview

ORFID is a package for compiling and summarizing passive integrated transponder (PIT) data collected using Oregon RFID OMRM and OSRS antenna readers. 


## Installation

ORFID is currently available as a development package on Github:

```{r install, eval = TRUE}
devtools::install_github("hugo-marques/ORFID")
library(ORFID)
```


## View field names

The output from Oregon RFID antenna readers is highly customizable. Available data fields and their descriptions can be viewed using:

```{r field names, eval = TRUE}
field_names()
```


## Loading the data

ORFID requires input data in raw format downloaded directly from Oregon RFID OMRM and OSRS antenna readers. Data files must be delimited by tab, comma, or semicolon; space delimited data are not supported. 

Data are loaded using one of three import functions: 

* `import_ORFID`: Imports detection records from OMRM and OSRS antenna readers 
* `import_ORFID_events`: Imports event data from OMRM and OSRS antenna readers
* `import_old_readers`: Imports detection data from previous generations of Oregon RFID antenna readers

```{r load data, eval = FALSE}
dat <- import_ORFID(file = "~/reader_1.txt", delim = "\t")
events <- import_ORFID(file = "~reader_1.txt", delim = "\t")
```


## Joining data into arrays

Multiple data files can be combined into an array representing all antennas within a designated study region. Individual files are combined into a list and joined using `join_multireader_data`. A new data field is created, LOC, which combines the site code (SCD) and antenna number (ANT) into a unique location variable.

```{r join, eval = FALSE}
reader_1 <- import_ORFID(file = "reader_1.txt", delim = "\t")
reader_2 <- import_ORFID(file = "reader_2.txt", delim = "\t")
reader_3 <- import_ORFID(file = "reader_3.txt", delim = "\t")
```

```{r join2, eval = TRUE}
dat_multi <- join_multireader_data(x = list(reader_1, reader_2, reader_3))
```


## Summarize data

Data from `import_ORFID` or `join_multireader_data` can be summarized to view site information and tag detections:

```{r summarize, eval = TRUE}
site_summary(dat_multi)
```

```{r summarize2, eval = TRUE}
tag_summary(dat_multi)
```


## View marker tag data

Marker tags are stationary tags used to constantly monitor the effectiveness of Oregon RFID antenna readers. Data from individual marker tags can be viewed and plotted using ORFID marker tag functions.

```{r marker, eval = TRUE}
marker_tag(dat_multi, "0000_000000005972")
```

```{r marker2, eval = TRUE, fig.width = 6, fig.heigh = 5}
marker_tag_plot(dat_multi, "0000_000000005972")
```


## Summarize directional data

PIT antennas are sometimes deployed along a linear migration route to monitor the directional movement of tagged individuals. ORFID has several functions that can be used to summarize directional data.

`tag_direction` is used to determine the direction of movement whenever an individual is detected at a new/subsequent antenna. The function requires a vector describing the order of locations an individual encounters as it travels along a directional gradient (e.g., from downstream to upstream).

```{r direction, eval = FALSE}
tag_direction(dat_multi, LOC_vec = c("loc1", "loc2", "loc3"))
```

`direction_summary` can then be used to summarize the time difference between the first and last detections for each unique tag within the system. For example, this function can be used to determine residence time upstream of a station.

```{r direction_summary, eval = FALSE}
dir <- tag_direction(dat_multi, LOC_vec = c("loc1", "loc2", "loc3"))
direction_summary(dir)
```

`ant_efficiency` is used to determine the efficiency for each antenna within a directional array. As with `tag_direction`, a vector is required that describes the order of locations an individual encounters along a linear migration route. Efficiency is calculated as the number of shared detections at location x and at any location after x, divided by the number of detections after location x. Efficiency cannot be calculated for the final antenna as there are no subsequent detections. Reversing the order of the location vector can inform efficiency in systems with movement in multiple directions.

```{r efficiency, eval = FALSE}
ant_efficiency(dat_multi, LOC_vec = c("loc1", "loc2", "loc3"))
```
